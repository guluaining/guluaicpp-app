# 附件三：中美双轨部署与合规实施方案
**Attachment 3: Global Deployment & Compliance Strategy**

### 核心战略：一个内核，两套部署 (One Codebase, Two Deployments)

我们不开发两个 App。我们使用 **Monorepo（单体仓库）** 策略，共享 90% 的业务逻辑和 UI 组件，通过**环境变量（Environment Variables）**和**配置开关**来区分中国版和国际版。

### 1. 技术架构：如何“一份代码，两地运行”

推荐使用 **Next.js**（全栈框架）结合 **TurboRepo**（Monorepo 管理工具）。

*   **代码仓库结构 (Monorepo Structure):**
    *   `apps/web-global`: 国际版入口（部署在 Vercel/AWS）。配置：Google Auth, Stripe, Google Maps, Gemini Direct.
    *   `apps/web-china`: 中国版入口（部署在 Aliyun/Tencent）。配置：微信/手机号登录, 支付宝/微信支付, 高德地图, AI 代理/国产大模型。
    *   `packages/ui`: **共享组件库**（Gulu 形象、VariableBox、动画逻辑、可视化引擎）。这是你的核心资产，改一处，两边生效。
    *   `packages/logic`: **共享逻辑**（C++ 模拟器核心算法、游戏状态管理）。

### 2. 基础设施与部署 (Infrastructure)

这是最大的区别点，必须物理隔离以保证速度和合规。

| 维度 | 国际版 (Global) | 中国版 (China) |
| :--- | :--- | :--- |
| **云服务商** | **AWS** 或 **Vercel** | **阿里云 (Aliyun)** 或 **腾讯云** |
| **域名** | `gulucoding.com` | `gulucoding.cn` (必须申请 **ICP 备案**，商业化需 **ICP 经营许可证**) |
| **CDN** | Cloudflare / CloudFront | 阿里云 CDN (国内节点) |
| **数据库** | AWS RDS (PostgreSQL) | 阿里云 RDS (PostgreSQL) |
| **用户数据** | 存储在海外 (GDPR 合规) | **必须存储在中国境内** (PIPL 个人信息保护法) |

**关键策略：数据隔离，内容同步。**
*   **用户数据 (User Data):** **不互通**。中国用户的手机号、学习进度存在中国数据库；美国用户存在美国数据库。这是为了法律合规（中国数据出境非常麻烦）。
*   **内容管理 (CMS):** **统一管理**。你可以搭建一个“超级管理后台”（Headless CMS，如 Strapi 或 Sanity），部署在香港或新加坡。
    *   当你更新了一节“成功之路”的课程，或者修复了一个算法 Bug，CMS 通过 API 将内容推送到中美两端的数据库。
    *   这样实现了“一次更新，全球同步”。

### 3. 核心难点：AI 服务的合规与连接

目前直接调用 Gemini API 在中国是无法访问的。

*   **方案 A (高性能代理 - 推荐初期):**
    *   中国版后端不直接连 Google，而是连接你在香港或新加坡搭建的 **AI Proxy Server**。
    *   用户请求 -> 阿里云上海 -> 阿里云香港(专线) -> Google Gemini。
    *   *风险：* 依然存在一定的监管风险，需确保不过滤敏感词。
*   **方案 B (模型路由 - 推荐长期):**
    *   在代码中做一个适配层 (AI Adapter)。
    *   **国际版：** 调用 `Google Gemini 2.0 Flash`。
    *   **中国版：** 自动切换调用国内合规且强大的模型（如**通义千问 Qwen-Max** 或 **DeepSeek-V3**）。现在的国产大模型在代码解释能力上已经非常强，且完全合规，速度极快。

### 4. 认证与支付 (Auth & Payment)

*   **国际版：**
    *   登录：Google Login, Email (Clerk / Auth0)。
    *   支付：Stripe (信用卡, Apple Pay)。
*   **中国版：**
    *   登录：**微信扫码登录** (这是核心，家长都在微信里)，手机验证码登录。
    *   支付：微信支付，支付宝。

### 5. 针对中国市场的特殊合规建议 (Regulatory)

1.  **定位 (Positioning):**
    *   **绝对不要**宣传为“学科培训”（Subject Tutoring）。C++ 属于“科技特长”、“素质教育”或“编程兴趣”，这在政策上是绿灯区。
    *   **避开关键词：** 避免使用“提分”、“包过”、“名校直升”等广告法违禁词。强调“逻辑思维”、“国际视野”、“科技素养”。
2.  **实名认证:** 中国互联网规定，用户注册必须绑定手机号（后台实名）。
3.  **内容审查:** 你的“自定义输入”功能，如果允许用户输入文字并公开显示（比如评论区），必须接入阿里云的内容安全 API（过滤涉黄涉政内容）。如果是纯单机输入数字，则问题不大。
4.  **备案 (ICP):** 只要服务器在中国，必须备案。建议尽早注册一个国内公司（或个体户），用于申请 ICP 备案和微信支付商户号。